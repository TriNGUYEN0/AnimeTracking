<div class="dashboard-container">
  <div class="page-header">
    <h2>Tableau de Bord Analytique</h2>
    <button class="btn-export" (click)="exportToPDF()">
      üì• T√©l√©charger PDF
    </button>
  </div>

  <div id="dashboard-content">
    @if (keyMetrics(); as metrics) {
      <div class="kpi-grid">
        <div class="kpi-card">
          <span class="kpi-icon">üé¨</span>
          <div class="kpi-info">
            <span class="kpi-value">{{ metrics.total_anime }}</span>
            <span class="kpi-label">Top Animes</span>
          </div>
        </div>

        <div class="kpi-card">
          <span class="kpi-icon">‚≠ê</span>
          <div class="kpi-info">
            <span class="kpi-value">{{ metrics.avg_score }}</span>
            <span class="kpi-label">Average Score</span>
          </div>
        </div>

        <div class="kpi-card">
          <span class="kpi-icon">üë•</span>
          <div class="kpi-info">
            <span class="kpi-value">{{ (metrics.total_members / 1000000) | number:'1.1-1' }}M</span>
            <span class="kpi-label">Total Members</span>
          </div>
        </div>

        <div class="kpi-card">
          <span class="kpi-icon">üìÖ</span>
          <div class="kpi-info">
            <span class="kpi-value">{{ metrics.active_years }}</span>
            <span class="kpi-label">Active years</span>
          </div>
        </div>
      </div>
    }

    <div class="charts-grid">
      
      <div class="chart-card">
        <div class="card-header">
          <h3>Distribution des Genres (Top 10)</h3>
          
          <div class="filter-controls">
            <select (change)="onYearFilterChange($event)" class="year-select">
              <option value="">Toutes les ann√©es</option>
              @for (year of availableYears(); track year) {
                <option [value]="year">{{ year }}</option>
              }
            </select>
          </div>
        </div>

        <div class="chart-wrapper">
          @if (genreChartData().datasets.length > 0 && genreChartData().datasets[0].data.length > 0) {
            <canvas baseChart
              [data]="genreChartData()"
              [type]="'polarArea'" 
              [options]="genreChartOptions">
            </canvas>
          } @else {
            <p style="color: #888;">Chargement...</p>
          }
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3>Yearly scrore's evolution </h3>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart 
            [data]="lineChartData()" 
            [type]="'line'" 
            [options]="lineChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card full-width">
        <div class="card-header">
          <h3>Top 10 Genres by Score</h3>
        </div>
        <div class="chart-wrapper scatter-wrapper"> 
          <canvas baseChart
            [data]="barChartData()"
            [type]="'bar'"
            [options]="barChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3>Studios with Top Animes</h3>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="studioChartData()"
            [type]="'bar'"
            [options]="studioChartOptions">
          </canvas>
        </div>
      </div>

      <div class="chart-card">
        <div class="card-header">
          <h3>Origine des Animes (Source)</h3>
        </div>
        <div class="chart-wrapper">
          <canvas baseChart
            [data]="sourceChartData()"
            [type]="'doughnut'"
            [options]="sourceChartOptions">
          </canvas>
        </div>
      </div>
      
    </div> </div>
</div>